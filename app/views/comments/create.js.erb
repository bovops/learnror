<% parent = "#{@commentable.class.to_s.downcase}_#{@commentable.id}" %>

<% if @comment.errors.present? %>
  $('<%= "##{parent} .comments-box .new_comment_form" %>').html('<%= j render partial: 'comments/form', locals: {commentable: @commentable, comment: @comment} %>');
<% else %>

  <% publish_to "/#{@commentable.class.to_s.downcase}s/#{@commentable.id}/comments" do %>
    $('<%= "##{parent} .comments-box .comments-list" %>').append('<%= j render partial: 'comments/comment', locals: {comment: @comment} %>');
  <% end %>

  if ($('<%= "#comment_#{@comment.id}" %>').length ) { console.log("comment <%= "#{@comment.id}" %> exists") }
  else {
    $('<%= "##{parent} .comments-box .comments-list" %>').append('<%= j render partial: 'comments/comment', locals: {comment: @comment} %>');
  }
  $('<%= "##{parent} .comments-box .new_comment_form" %>').children('form')[0].reset();
<% end %>
