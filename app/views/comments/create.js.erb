<% parent_id = "#{parent_type.to_s}-#{parent.id}" %>

<% if resource.errors.present? %>
  $('<%= "##{parent_id} .comments-box .new-comment-form" %>').html('<%= j render 'comments/form' %>');
<% else %>

  <% publish_to "/#{parent_type.to_s}s/#{parent.id}/comments" do %>
    $('<%= "##{parent_id} .comments-box .comments-list" %>').append('<%= j render 'comments/comment' %>');
  <% end %>

  if ($('<%= "#comment-#{resource.id}" %>').length ) { console.log("comment <%= "#{resource.id}" %> exists") }
  else {
    $('<%= "##{parent_id} .comments-box .comments-list" %>').append('<%= j render 'comments/comment' %>');
  }
  $('<%= "##{parent_id} .comments-box .new-comment-form" %>').children('form')[0].reset();
<% end %>
